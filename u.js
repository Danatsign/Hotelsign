console.clear();class datepicker{constructor(a,d){this._PICKER=a,this._INPUT=a.getElementsByTagName("input")[0],this._YEARLIST=a.getElementsByClassName("list__years")[0],this._MONTHLIST=a.getElementsByClassName("list__months")[0],this._DAYLIST=a.getElementsByClassName("list__days")[0],this._MONTHLABEL=a.getElementsByClassName("datepicker__month")[0],this._CONTAINER=a.getElementsByClassName("datepicker__lists")[0],this.closeDatePicker=this.closeDatePicker.bind(this);var b=new Date(Date.parse(d.max)),c=new Date(Date.parse(d.min||"1900-01-01"));this._CONFIG={MAX_YEAR:b.getFullYear(),MAX_MONTH:b.getMonth()+1,MAX_DAY:b.getDate(),MAX_DATE:`${b.getFullYear()}-${b.getMonth()+1}-${b.getDate()}`,MIN_YEAR:c.getFullYear(),MIN_MONTH:c.getMonth(),MIN_DAY:c.getDate(),MIN_DATE:`${c.getFullYear()}-${c.getMonth()}-${c.getDate()}`,VALIDATOR:d.validator?d.validator:/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}/g},this.onInputFocus=this.onInputFocus.bind(this),this._VALUES={year:void 0,month:void 0,day:void 0},this._MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],this._CURRENT_STEP=0,this.setYear=this.setYear.bind(this),this.setMonth=this.setMonth.bind(this),this.setDay=this.setDay.bind(this),this.init=this.init.bind(this),this.handleArrowKeys=this.handleArrowKeys.bind(this),this.removeKeyInputs=this.removeKeyInputs.bind(this),this.detectKeyInputs=this.detectKeyInputs.bind(this),this.validate=this.validate.bind(this),this.init(this._CONFIG.MIN_DATE,this._CONFIG.MAX_DATE)}betweenYears(e,f){for(var d=[],a=e.split("-"),b=f.split("-"),g=new Date(a[0],a[1],a[2]),h=new Date(b[0],b[1],b[2]),c=g.getFullYear();c<h.getFullYear()+1;c++)d.unshift(c);return d}prepareMonths(e){var a,b,c=this._MONTHS.slice();this._CONFIG.MAX_YEAR===e?b=(a=c.splice(0,this._CONFIG.MAX_MONTH)).map(a=>`<li label="month ${a}" tabindex="0">${a}</li>`):this._CONFIG.MIN_YEAR===e?b=(a=c.slice(this._CONFIG.MIN_MONTH,12)).map(a=>`<li label="month ${a}" tabindex="0">${a}</li>`):(a=c,b=c.map(a=>`<li label="month ${a}" tabindex="0">${a}</li>`)),this._MONTHLIST.innerHTML=b.join("");var f=this._MONTHLIST.getElementsByTagName("li");for(let d=0;d<a.length;d++)f[d].addEventListener("click",b=>{b.stopPropagation(),this.setMonth(this._MONTHS.indexOf(a[d])+1)})}prepareDays(f){var d,g=this._MONTHS.indexOf(f)+1,a=[],h=new Date(this._VALUES.year,g,0).getDate()+1;for(let b=1;b<h;b++)a.push(b);d=this._CONFIG.MAX_YEAR===this._VALUES.year&&this._CONFIG.MAX_MONTH===this._VALUES.month?(a=a.splice(0,this._CONFIG.MAX_DAY)).map(a=>`<li label="${a}th of ${this._MONTHS[this._VALUES.month-1]}" tabindex="0">${a}</li>`):this._CONFIG.MIN_YEAR===this._VALUES.year&&this._CONFIG.MIN_MONTH+1===this._VALUES.month?(a=a.slice(this._CONFIG.MIN_DAY,31)).map(a=>`<li label="${a}th of ${this._MONTHS[this._VALUES.month-1]}" tabindex="0">${a}</li>`):a.map(a=>`<li label="${a}th of ${this._MONTHS[this._VALUES.month-1]}" tabindex="0">${a}</li>`),this._DAYLIST.innerHTML=d.join("");var e=this._DAYLIST.getElementsByTagName("li"),i=e.length;for(let c=0;c<i;c++)e[c].addEventListener("click",b=>{b.stopPropagation(),this.setDay(a[c])})}setYear(a){this._VALUES.year=a,this.prepareMonths(this._VALUES.year),this._CONTAINER.classList.add("view--month"),this._CURRENT_STEP=1,this._PICKER.getElementsByClassName("list__months")[0].getElementsByTagName("li")[0].focus()}setMonth(a){this._MONTHLABEL.innerHTML=this._MONTHS[a-1],this._VALUES.month=a,this.prepareDays(a),this._CONTAINER.classList.add("view--day"),this._CURRENT_STEP=2,setTimeout(()=>{this._PICKER.getElementsByClassName("list__days")[0].getElementsByTagName("li")[0].focus()},300)}setDay(a){this._VALUES.day=a,this.closeDatePicker(!0),this._CURRENT_STEP=0,this.detectKeyInputs()}closeDatePicker(a){this._CONTAINER.className="datepicker__lists",this._PICKER.classList.remove("datepicker--visible"),a&&(this._INPUT.value=`${this.formatNumber(this._VALUES.day)}/${this.formatNumber(this._VALUES.month)}/${this.formatNumber(this._VALUES.year)}`)}formatNumber(a){return a<10?"0"+a:a}onInputFocus(){this._PICKER.classList.add("datepicker--visible"),this._PICKER.getElementsByClassName("list__years")[0].getElementsByTagName("li")[0].focus(),this._CURRENT_STEP=0,this.detectKeyInputs()}isMobile(){return!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}init(c,d){if(this.isMobile())this._INPUT.type="date";else{this._INPUT.addEventListener("focus",this.onInputFocus),this._INPUT.addEventListener("input",this.validate),window.addEventListener("click",a=>{this.closeDatePicker(),this.removeKeyInputs()}),this._PICKER.addEventListener("click",a=>{a.stopPropagation()});var e=this.betweenYears(c,d);this._YEARLIST.innerHTML=e.map((a,b)=>`<li label="year ${a}" tabindex="0">${a}</li>`).join("");var b=this._YEARLIST.getElementsByTagName("li"),f=b.length;for(let a=0;a<f;a++)b[a].addEventListener("click",b=>{b.stopPropagation(),this.setYear(e[a])})}}detectKeyInputs(){document.addEventListener("keydown",this.handleArrowKeys)}removeKeyInputs(){document.removeEventListener("keydown",this.handleArrowKeys)}handleArrowKeys(a){let b=37===a.keyCode||39===a.keyCode||13===a.keyCode;b&&(37===a.keyCode?document.activeElement:document.activeElement.click())}validate(a){var b=a.target.value;this._CONFIG.VALIDATOR.test(b)}}var init=new datepicker(document.querySelectorAll(".datepicker__container")[0],{max:"2020-12-31",min:"1920-1-1"})
