console.clear();class datepicker{constructor(t,e){this._PICKER=t,this._INPUT=t.getElementsByTagName("input")[0],this._YEARLIST=t.getElementsByClassName("list__years")[0],this._MONTHLIST=t.getElementsByClassName("list__months")[0],this._DAYLIST=t.getElementsByClassName("list__days")[0],this._MONTHLABEL=t.getElementsByClassName("datepicker__month")[0],this._CONTAINER=t.getElementsByClassName("datepicker__lists")[0],this.closeDatePicker=this.closeDatePicker.bind(this);var i=new Date(Date.parse(e.max)),s=new Date(Date.parse(e.min||"1900-01-01"));this._CONFIG={MAX_YEAR:i.getFullYear(),MAX_MONTH:i.getMonth()+1,MAX_DAY:i.getDate(),MAX_DATE:`${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}`,MIN_YEAR:s.getFullYear(),MIN_MONTH:s.getMonth(),MIN_DAY:s.getDate(),MIN_DATE:`${s.getFullYear()}-${s.getMonth()}-${s.getDate()}`,VALIDATOR:e.validator?e.validator:/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}/g},this.onInputFocus=this.onInputFocus.bind(this),this._VALUES={year:void 0,month:void 0,day:void 0},this._MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],this._CURRENT_STEP=0,this.setYear=this.setYear.bind(this),this.setMonth=this.setMonth.bind(this),this.setDay=this.setDay.bind(this),this.init=this.init.bind(this),this.handleArrowKeys=this.handleArrowKeys.bind(this),this.removeKeyInputs=this.removeKeyInputs.bind(this),this.detectKeyInputs=this.detectKeyInputs.bind(this),this.validate=this.validate.bind(this),this.init(this._CONFIG.MIN_DATE,this._CONFIG.MAX_DATE)}betweenYears(t,e){for(var i=[],s=t.split("-"),a=e.split("-"),n=new Date(s[0],s[1],s[2]),h=new Date(a[0],a[1],a[2]),r=n.getFullYear();r<h.getFullYear()+1;r++)i.unshift(r);return i}prepareMonths(t){var e,i,s=this._MONTHS.slice();this._CONFIG.MAX_YEAR===t?i=(e=s.splice(0,this._CONFIG.MAX_MONTH)).map((t=>`<li label="month ${t}" tabindex="0">${t}</li>`)):this._CONFIG.MIN_YEAR===t?i=(e=s.slice(this._CONFIG.MIN_MONTH,12)).map((t=>`<li label="month ${t}" tabindex="0">${t}</li>`)):(e=s,i=s.map((t=>`<li label="month ${t}" tabindex="0">${t}</li>`))),this._MONTHLIST.innerHTML=i.join("");var a=this._MONTHLIST.getElementsByTagName("li");for(let t=0;t<e.length;t++)a[t].addEventListener("click",(i=>{i.stopPropagation(),this.setMonth(this._MONTHS.indexOf(e[t])+1)}))}prepareDays(t){var e,i=this._MONTHS.indexOf(t)+1,s=[],a=new Date(this._VALUES.year,i,0).getDate()+1;for(let t=1;t<a;t++)s.push(t);e=this._CONFIG.MAX_YEAR===this._VALUES.year&&this._CONFIG.MAX_MONTH===this._VALUES.month?(s=s.splice(0,this._CONFIG.MAX_DAY)).map((t=>`<li label="${t}th of ${this._MONTHS[this._VALUES.month-1]}" tabindex="0">${t}</li>`)):this._CONFIG.MIN_YEAR===this._VALUES.year&&this._CONFIG.MIN_MONTH+1===this._VALUES.month?(s=s.slice(this._CONFIG.MIN_DAY,31)).map((t=>`<li label="${t}th of ${this._MONTHS[this._VALUES.month-1]}" tabindex="0">${t}</li>`)):s.map((t=>`<li label="${t}th of ${this._MONTHS[this._VALUES.month-1]}" tabindex="0">${t}</li>`)),this._DAYLIST.innerHTML=e.join("");var n=this._DAYLIST.getElementsByTagName("li"),h=n.length;for(let t=0;t<h;t++)n[t].addEventListener("click",(e=>{e.stopPropagation(),this.setDay(s[t])}))}setYear(t){this._VALUES.year=t,this.prepareMonths(this._VALUES.year),this._CONTAINER.classList.add("view--month"),this._CURRENT_STEP=1,this._PICKER.getElementsByClassName("list__months")[0].getElementsByTagName("li")[0].focus()}setMonth(t){this._MONTHLABEL.innerHTML=this._MONTHS[t-1],this._VALUES.month=t,this.prepareDays(t),this._CONTAINER.classList.add("view--day"),this._CURRENT_STEP=2,setTimeout((()=>{this._PICKER.getElementsByClassName("list__days")[0].getElementsByTagName("li")[0].focus()}),300)}setDay(t){this._VALUES.day=t,this.closeDatePicker(!0),this._CURRENT_STEP=0,this.detectKeyInputs()}closeDatePicker(t){this._CONTAINER.className="datepicker__lists",this._PICKER.classList.remove("datepicker--visible"),t&&(this._INPUT.value=`${this.formatNumber(this._VALUES.day)}/${this.formatNumber(this._VALUES.month)}/${this.formatNumber(this._VALUES.year)}`)}formatNumber(t){return t<10?"0"+t:t}onInputFocus(){this._PICKER.classList.add("datepicker--visible"),this._PICKER.getElementsByClassName("list__years")[0].getElementsByTagName("li")[0].focus(),this._CURRENT_STEP=0,this.detectKeyInputs()}isMobile(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i),!1}init(t,e){if(this.isMobile())this._INPUT.type="date";else{this._INPUT.addEventListener("focus",this.onInputFocus),this._INPUT.addEventListener("input",this.validate),window.addEventListener("click",(t=>{this.closeDatePicker(),this.removeKeyInputs()})),this._PICKER.addEventListener("click",(t=>{t.stopPropagation()}));var i=this.betweenYears(t,e);this._YEARLIST.innerHTML=i.map(((t,e)=>`<li label="year ${t}" tabindex="0">${t}</li>`)).join("");var s=this._YEARLIST.getElementsByTagName("li"),a=s.length;for(let t=0;t<a;t++)s[t].addEventListener("click",(e=>{e.stopPropagation(),this.setYear(i[t])}))}}detectKeyInputs(){document.addEventListener("keydown",this.handleArrowKeys)}removeKeyInputs(){document.removeEventListener("keydown",this.handleArrowKeys)}handleArrowKeys(t){37!==t.keyCode&&39!==t.keyCode&&13!==t.keyCode||(37===t.keyCode?document.activeElement:document.activeElement.click())}validate(t){var e=t.target.value;this._CONFIG.VALIDATOR.test(e)}}var init=new datepicker(document.querySelectorAll(".datepicker__container")[0],{max:"2020-12-31",min:"1920-1-1"});
